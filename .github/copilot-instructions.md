# Copilot Instructions for Asteroits

- **Engine & entry**: Godot 4.4 project (GL Compatibility). World singleton autoloads [world.gd](world.gd); main scene is already set in `project.godot`. Run via Godot editor or `godot4 --path .`.
- **World grid & economy**: [world.gd](world.gd) defines a 625×625 cell board (16px cells) and tracks `board`, `resources`, `bank`, `extra_lives`, `spawn_points`, and `colors` per team. Base bank starts at 1000, extra lives at 2. Building non-harvesters costs 200; harvesters only place on resource tiles. Turbo burns bank (cost per frame) and shield boosts cost 1000.
- **Setup flow**: `_ready()` seeds clustered resources, scatters 4 bases (one per quadrant), registers players, and spawns the first asteroid. `register_player()` assigns spawn/color from pools and initializes economy/lives.
- **Placement rules**: Use `World.build()` to place walls/harvesters/turrets so cells snap to grid, colors apply, costs deduct, resource tiles hide, and `node.cell` is set. `board` rejects overlap. Use `world_to_cell`/`cell_to_world` helpers when adding new structures.
- **Resources & income**: Resource tiles are [resource.gd](resource.gd) nodes grouped as `resources`. [harvester.gd](harvester.gd) ticks every 0.25s, calling `World.harvest()` to convert 1 resource to 1 bank until empty, then frees both harvester and tile.
- **Combat**: [player.gd](player.gd) movement is physics-based with acceleration/turn limits. Firing spawns [bullet.gd](bullet.gd) raycast-like projectiles; bullets ignore friendly players/shields, otherwise call `on_hit` and usually free. Weapon upgrades increase spread/shot count.
- **Survivability**: Players get invincibility on respawn; shield boosts add/stack shield health. Extra lives tracked per team; death either consumes a life or triggers explosion/camera handoff. Coins drop from tiny asteroids: +life, +10k bank, or weapon upgrade (see coin scripts).
- **Structures**: [wall.gd](wall.gd) (health 5) damages intruders then self-damages on non-bullet collision. [turret.gd](turret.gd) auto-fires in facing direction on cooldown. All structures extend [explodable.gd](explodable.gd) for shared damage/FX.
- **Asteroids**: [asteroid.gd](asteroid.gd) wraps world bounds, splits into four on hit until radius 10, and may drop coins. World tracks `asteroid_count` and respawns when none remain.
- **Bases & win**: [base.gd](base.gd) captures to the entering player’s team and recolors. `check_win_conditions()` ends the game when a team owns all four bases or only one player remains.
- **Input layer**: [PlayerInput](player_input.gd) is abstract. [human_input.gd](human_input.gd) maps to the input actions defined in `project.godot` (WASD/left stick to move, arrow-like axes/right stick to aim; Z/C/X for wall/harvester/turret; triggers for turbo; button 0 for shield). Human/AI scenes inject the appropriate input object into `Player`.
- **HUD**: [hud.gd](hud.gd) mirrors bank per alive team, base ownership, and extra lives for the tracked player using duplicated templates. Set `World.hud.player` so lives render for the active pilot.
- **AI architecture**: [ai/ai_player.gd](ai/ai_player.gd) randomizes team and applies biases; [ai/ai_brain.gd](ai/ai_brain.gd) chooses modes (harvest/combat/collision avoidance/base/asteroid/unstick/turret) and build strategies, then drives [ai/ai_input.gd](ai/ai_input.gd). [ai/ai_helpers.gd](ai/ai_helpers.gd) provides utilities: nearest enemy/resource, braking movement, collision anticipation, smart shooting, etc. Modes set `target_position/aim` rather than issuing direct movement.
- **Groups & signals**: Logic relies on groups (`players`, `bases`, `asteroids`, `harvesters`, `walls`, `turrets`, `resources`). When adding new nodes, register the right groups so HUD, AI, and win checks see them.
- **Colors & teams**: Use `World.team_color(team)` for consistent coloring; `colors` dictionary stores Color or hex strings. Avoid creating teams without registering through `World.register_player()` so bank/lives/spawns are initialized and colors assigned.
- **Camera handling**: Player death can reparent its camera to explosions and later defer switching to the richest surviving player (`World._switch_camera_deferred`). Keep cameras under Player when adding viewpoints.
- **Map bounds**: Player movement clamps to `World.BOUNDS`; asteroids wrap in `_integrate_forces`. Keep new movement code respecting the same bounds or wrapping scheme.
- **Testing/dev tips**: To quickly start, place a `HumanPlayer` or `AIPlayer` scene into the main scene; World singleton handles registration. Spawn positions/colors are consumed in order—ensure enough for new teams or extend `available_spawn_locations/colors` in [world.gd](world.gd).

Questions or missing pieces? Tell me which sections need more depth and I’ll refine them.
